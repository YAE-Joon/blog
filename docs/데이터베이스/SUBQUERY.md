***
## 01. 서브쿼리

- 하나의 쿼리 안에 포함된 또 하나의 쿼리, 메인 쿼리가 서브쿼리를 포함하는 종속적인 관계
		ex) 연봉이 얼마인 여자가 책을 얼마나 보는지, 또 년도마다 다른 지 등. 쿼리문이 복잡해질 때 사용
	- 알려지지 않은 기준을 이용한 검색에 유용 
		-연봉이 상위 5% 인 여자 
	- 메인 쿼리가 실행되기 이전에 한 번만 실행 
		- select 문은 서브쿼리 -> 메인 쿼리 순으로 실행됨. 
	- 한 문장에서 여러번 사용 가능 
		- 서브쿼리의 서브쿼리도 가능
``` SQL
	SELECT * FROM employee
	WHERE 급여 >
	(SELECT 급여 FROM employee WHERE 이름 = 'elice');
	// 급여를 비교하기 위해 elice의 급여를 알지 못해도, elice의 급여를 서브쿼리로 가져온 뒤 비교가능
```
		
- 서브쿼리 사용시 주의사항
		1. 서브쿼리는 괄호와 함께 사용되어야 한다.
		2. 서브쿼리 안에서 ORDER BY 절은 사용할 수 없다.
		3. 서브쿼리는 연산자의 오른쪽에 사용되어야 한다.
		4. 서브쿼리는 오로지 SELECT문으로만 작성 할 수 있다.
``` SQL
	SELECT * FROM employee
	WHERE 급여 >    // 메인쿼리
	(SELECT 급여 FROM employee WHERE 이름 = 'elice');  //서브쿼리
```
		
***
## 02. 반환에 따른 분류

- 단일 행 서브쿼리 : 결과가 한 행만 나오는 서브쿼리. 서브쿼리가 결과를 1개의 값만 반환하고, 이 결과를 메인쿼리로 전달하는 쿼리
``` SQL
	SELECT * FROM employee
	WHERE 급여 >    //단일 행 연산자
	(SELECT 급여 FROM employee WHERE 사원번호 = 1);  
	//사원번호는 기본적으로 1개만 있으므로 한 개의 행만 반환함 = 단일행 
``` 
-  단일 행 연산자 : 오른 쪽이 서브 쿼리, 왼쪽이 메인 쿼리이다.
	- `=` : 같다
	- `<>` : 같지 않다
	- `>` : 크다
	- `>=` : 크거나 같다
	- `<` : 작다
	- `<=` : 작거나 같다	
- 다중 행 서브쿼리 : 결과가 한 행만 나오는 단일행 서브쿼리와는 다르게 서브쿼리가 결과를 2개 이상 반환하고, 이 결과를 메인쿼리로 전달하는 쿼리
``` SQL
	SELECT * FROM employee
	WHERE 급여 IN (   //다중 행 연산자
	SELECT max(급여) FROM employee GROUP BY 부서번호);  
	//MAX 의 경우 2개이상 있을 수 있으므로 한 개 이상의 행을 반환함 = 다중행 
``` 
- 다중 행 연산자 : 오른 쪽이 서브 쿼리, 왼쪽이 메인 쿼리이다.
	- IN : 서브쿼리 결과에 존재하는 값들 중 하나라도 만족하면 반환
	- EXISTS : 서브쿼리 결과 값이 존재한느지 여부를 확인한다.
	- ANY : 하나라도 만족하면 반환, 비교 연산 가능 
	- ALL : 모두 만족하면 반환, 비교 연산 가능
- 다중 컬럼 서브쿼리 : 서브쿼리의 결과가 여러 개의 컬럼을 반환하며, 메인쿼리의 조건과 동시에 비교
	 - ex) 각 부서에서 가장 높은 급여를 받는 직원의 이름과 급여를 출력
***
## 03.위치에 따른 분류

- WHERE 절에 사용되는 서브쿼리가 가장 일반적인 서브쿼리이다. 그 외에 스칼라 서브쿼리가 있다.
	- 스칼라 서브쿼리 : **SELECT** 절에서 사용하는 서브쿼리, 스칼라 서브쿼리는 오로지 한 행만 반환한다. 마치 JOIN을 사용한 것과 같은 결과를 나타낸다. JOIN 사용시 보다 스칼라 서브쿼리시 계산속도가 더 빠른 경우가 있어서 이 명령어를 사뷰용한다.
```SQL
		SELECT students.name,(
		SELECT math            //서브쿼리가 SELECT 문 안에 들어옴
		FROM middle_test as m
		WHERE m.student_id = students.student_id
		) AS middle_avg  // as middle_avg <-- 별명을 지어주는 것임. 
		FROM students;
```
***
## 04. 동작하는 방식에 따른 서브쿼리 분류

- 서브쿼리에 메인쿼리의 컬럼이 포함되는지에 따라 분류할 수 있다.
	- 연관 서브쿼리 : 메인쿼리의 컬럼이 서브쿼리에 포함. 메인쿼리의 컬럼은 서브쿼리에 특정 조건으로 사용
``` SQL
	SELECT * FROM employee A
	WHERE 급여 >  
	(SELECT AVG(급여) FROM employee B WHERE B.사원번호 = A.사원번호);  
	//서브쿼리의 값이 메인쿼리의 컬럼에서 와야한다.
 ```
- 비연관 서브쿼리 : 메인쿼리 컬럼이 서브쿼리에 포함되지 않으며, 주로 메인쿼리에 특정한 값을 제공할 때 사용
``` SQL
	SELECT * FROM employee A
	WHERE 아이디 =    //단일 행 연산자
	(SELECT 아이디 FROM employee B WHERE name = 이름);  
	//서브쿼리 자체만으로도 동작이 가능 
```
***
## 05. 뷰

- 다른 테이블에서 파생된 테이블이다. 물리저긍로 데이터가 저장되는 것이 아니라, 논리적으로만 존재하며 뷰를 사용한 질의 시에는 DBMS에서 뷰 정의에 따라 질의를 재작성하여 수행한다.
- 뷰의 장점
	- 독립성 : 테이블 구조가 변경되어도 뷰를 사용하고 있는 응용 프로그램은 변경하지 않아도 된다.
	- 편리성 : 자주 사용되는 복잡한 쿼리를 미리 뷰로 정의해 놓으면, 추후 쿼리는 간단하게 표현가능
	- 보안성 : 사용자의 권한에 따라 열람 가능한 데이터를 다르게 할 수 있다. 권한에 따라 확인 가능한 컬럼을 정의하여 뷰를 생성하면, 기본 테이블 노출없이 접근 제어를 할 수 있다.
- Ex)
```SQL
  
create VIEW EMPLOYEE_DEV As(
SELECT employee_id, salary from EMPLOYEE
where department_name='개발');
```
