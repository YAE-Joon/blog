---
title: "예외처리"
description: "예외처리에 대한 내용"
tag: ["예외처리","오류","exception"]
sidebar_position: 3
---

- 프로그래밍의 오류(error)란 프로그램이 개발자가 의도하지 않은 상태로 빠지는 것을 뜻한다. 오류의 크기에 따라서 프로그램에 영향의 범위도 달라지며, 최악의 상황에는 프로그램을 강제 종료 시키기도 한다.

- 에러처리를 통해 프로그램이 의도치 않은 상태로 빠지지 않게 할 수 있다.
***
## 1. 프로그래밍의 오류 종류

- 컴파일 에러(compile - time error): 소스 코드 컴파일 시에 발생하는 에러
	-소스 코드 컴파일 시 발생. 문법 구문 오류 등, 말 그대로 코드 문법이 잘못되어 컴파일러가 해석하지 못해 발생하는 에러. IDE가 javac로 주기적으로 컴파일을 해서 미리 컴파일 에러들을 표시해주고, 프로그램 실행 전에 발생하기 때문에 에러중 가장 안전한 에러
- 런타임 에러(runtime error): 프로그램 실행 시 에 발생하는 에러
	-소스 코드 컴파일 후 프로그램을 실행했을 때 발생하는 에러, 개발자의 설계 미스로 발생하는 에러이기도 하며, 발생 시 원인을 찾아서(Root cause analysis)해결을 해야 한다. 그렇기 때문에 런타임으로 에러가 발생할 수 있는 부분을 잘 찾아서 대비를 철저히 해야한다. 개발자가 설계를 최대한 오류 없도록 설계, 코드를 작성하여도 프로그램 실행 시 어떤 일들이 발생할 지 모르기 때문에 100% 피하기 힘들다. 
	 프로그램 실행 후에 발생하기 때문에 심각할 수 있는 에러
	
- 논리 에러 (logical error): 프로그램이 문제없이 실행 되지만 개발자의 의도와는 다르게 동작하는 것
	-버그를 말함. 프로그램은 문제없지만 , 개발자의 의도와 다르게 결과나 과정이 나올 때 논리 에러라고 함.
***

## 2. Java의 오류와 예외

- 자바는 크게 2가지의 오류 클래스를 제공함. 
	- Error : 개발자가 다룰 수 없는 오류, 프로그램이 무조건 종료, Out-Of-Memory에러와 같이 심각성이 높은 시스템 상의 오류들을 나타내기 때문에, 예외 처리를 할 수 없음.
	- Exception : 개발자가 다룰 수 있는 오류, 개발자가 오류를 잡아서 프로그램이 안전하게 종료를 하거나 무시하거나 예외 처리를 하여 특정 코드가 다시 정상 작동할 수 있도록 할  수 있음. 컴파일 타임 에러와 런타임 에러를 포함
		- Checked Exception : 컴파일 타임 에러와 관련된 예외 클래스들.
			-처리 여부 : 반드시 예외 처리 필요, try-catch로 감싸서 에러를 처리하거나 throws 키워드를 사용해서 현재 메서드  호출자에게 에러처리를 위임해서 철하도록 유도, 예외 처리를 하지 않으면 컴파일러 에서 에러를 던짐
		- Unchecked Exception : 런타임 에러와 관련된 예외 클래스들.
			-처리여부: 명시적으로 처리 필요X, checked exception과는 다르게, try-catch문으로 예외 처리를 안해도 문제 없이 컴파일이 된다.
			-확인 시점: 런타임
		- 이렇게 2가지로 나누는 기준은 컴파일 타임에러냐 런타임 에러냐도 있지만, 에외 처리 동작(코드)의 필수 여부가 큼.![예외 처리-20250101231337647.webp](images%2F%EC%98%88%EC%99%B8%20%EC%B2%98%EB%A6%AC-20250101231337647.webp)
***
## 3. 예외 처리 방법

- 2가지 방법이 있다.
1. try-catch문을 이용한 방법
2. throws 키워드를 이용해서 예외 처리를 현재 메서드 호출자에게 위임하는 방법
	단, 코드로 모든 예외를 처리한다고 하여 모든 예외에 대비되었다고 100% 장담 불가능.
	
- 예외 처리의 포인트는 프로그램이 내부적으로 오류(예외적상황)가 비정상적인상태로 빠졌을 때 정상적인 상태로 돌아오게끔 하는 것에 있다.
	
- Resource : Java가 외부에서 데이터를 가져오는 값들. DB, Network, File같은 것들이 Resource이다. 자바내부 코드와 다르게 이 resource들은 불안정하다.  이 Resource를 사용하기 위해서 호출을 했다면, 반드시 close를 해주어야 한다.
	
- `finally {}`: try-catch문에서 exception이 터지던 안터지던 상관없이 {}안에 코드를 실행한다.
	-`try-with-Resource` : `close()` 로 인해 코드가 복잡해지는것을 간소화하기위해 나온 작업
	-`try(FileWriter f = new FileWriter("data.txtx")){f.write()}catch(IOException e){};` : try의 () 안에 resource와 관련된 작업을 할때, 자동으로 close를 해준다.  
	
***
## 4. 예외 기본 규칙

- 예외는 폭탄돌리기 같이 처리하거나 처리하지 못하면 예외를 던저야 한다.
	- 던진다는 것은, 상위 클래스로 예외처리를 위임하겠다는 뜻.상위 클래스에 예외를 전달한다.
- 예외를 잡거나 던질 때, 지정한 예외 뿐만 아니라, 그 예외의 자식들도 모두 잡는다.
	- ex) Exception으로 잡으면 IO Exception 등, 하위 계층을 모두 잡는다.
- Exception 과  그 하위 예외는 모두 컴파일러가 체크하는 체크 예외이다. (RuntimeException은 예외)
- 체크 예외는 잡아서 처리하거나, 또는 밖으로 던지도록 선언해야한다. 그렇지 않으면 컴파일 오류가 발생

***
## 5. 체크 예외 활용

- 기본적으로 언체크(런타임)예외를 사용하는 게 좋다.
- 체크 예외는 비지니스 로직상 의도적으로 던지는 예외에만 사용
	- 해당 예외를잡아서 반드시 처리해야 하는 문제일 때만 체크 예외를 사용해야 한다.
		- ex) 계좌이체 실패 예외
		- 결제시 포인트 부족 예외
		- 로그인 ID,PW 불일치 예외
- 체크예외의 문제점
	- Repository 는 DB 에 데이터를 저장하고 관리해서 SQLException 체크예외를 던진다.
	- NetworkClient는 외부 네트워크에 접속해서 기능하는 객체, ConnectionException 체크예외를 던진다.
	- 서비스 계층에서는 이 두 Exception을 모두 처리해야한다. 하지만 연결 실패나, 데이터베이스에서 생성되는 문제는 애플리케이션 로직에서 처리할 방법이 없기 때문에, 둘다 밖으로 던진다.
	- 컨트롤러도 . 두 예외를 처리할 방법이 없다. 이렇게 해결이 불가능한 공통 예외는 별도의 오류 로그를 남기고, 개발자가 오류를 빨리 인지할 수 있도록 알려야 한다.
	- 문제점 :
		- 대부분의 예외는 복구가 불가능하다. 데이터베이스의 문제를 서비스나 컨트롤러에서 해결할 수없기 때문에, 일관성 있게 공통으로 처리해야한다. `ControllerAdvice`를 사용하면 이런 부분을 깔끔하게 공통으로 해결할 수 있다.
		- 복구가 불가능한 예외이지만 체크예외이기 때문에 throws를 통해 예외를 던져야한다. 이 경우 문제점은 향후 Repository를 변경한다면, SQLException이 아니라 JPAException으로 예외가 변경되도록 고쳐야한다. 
	- 해결법: checked exception을 try-catch문을 통해 runtimeException으로 전환해서 예외를 던진다. 이 때 기존 예외를 함께 포함해주어야 예외 출력시 스택 트레이스에서 기존 예외도 함께 확인이 가능하다.
- 예외 포함과 스택 트레이스
		**예외전환시 기존 예외를 포함해주지 않으면 큰 문제가 발생한다.
	- 로그를 출력할 때 마지막 파라미터에 예외를 넣어주면 로그에 스택 트레이스를 출력할 수 있다.
	- 예) `log.info("message={}","message",ex)`, 여기에서 마지막에 `ex`를 전달하는데, 이렇게 하면 스택 트레이스에 로그를 출력할 수 있다.
